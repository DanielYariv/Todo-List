<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ToDo-DanielY</title>

    <!-- boostrap  -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    />

    <style>
      .btn-circle {
        border-radius: 20px;
      }
      .alertP {
        color: red;
        margin-left: 4px;
        font-size: 10px;
      }
      .priority {
        width: 35%;
        text-align: center;
        height: 1.3rem;
      }

      /* TODO:fix the margin - finish task checkBox*/
    </style>
  </head>
  <body>
    <div class="container">
      <h1>To Do</h1>
      <div class="card" style="width: 18rem">
        <ul id="dynamicUl" class="list-group list-group-flush">
          <li class="list-group-item">
            <h5 class="card-title">
              go to gym
              <input
                class="form-check-input checkBox"
                type="checkbox"
                value=""
                aria-label="..."
              />
            </h5>
            <h6 class="card-subtitle mb-2 text-body-secondary">
              <i class="bi bi-calendar"></i> 10:00, 23.04
            </h6>
          </li>
          <li class="list-group-item">
            <h5 class="card-title">
              Card title
              <input
                class="form-check-input checkBox"
                type="checkbox"
                value=""
              />
            </h5>
            <h6 class="card-subtitle mb-2 text-body-secondary">
              Card subtitle
            </h6>
          </li>
        </ul>
      </div>

      <!-- Button trigger add task modal -->
      <button
        type="button"
        class="btn btn-danger btn-circle"
        data-bs-toggle="modal"
        data-bs-target="#taskModal"
      >
        <i class="bi bi-plus"></i>
      </button>

      <!-- add task modal -->
      <div
        class="modal fade"
        id="taskModal"
        tabindex="-1"
        aria-labelledby="taskModal"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="taskModalLabel">New Task</h5>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <input
                  type="text"
                  class="form-control"
                  id="taskName"
                  placeholder="Task Name"
                />
                <p id="taskNameP" class="alertP"></p>
              </div>
              <div class="mb-3">
                <select id="prioritySelect" class="form-select">
                  <option value="" selected>Priority</option>
                  <option value="1">High</option>
                  <option value="2">Medium</option>
                  <option value="3">Low</option>
                </select>
                <p id="priorityP" class="alertP"></p>
              </div>
              <div class="mb-3">
                <input type="date" id="chooseDate" class="form-control" />
                <p id="dateP" class="alertP"></p>
              </div>
              <div class="mb-3">
                <input type="time" id="chooseTime" class="form-control" />
              </div>
            </div>
            <div class="modal-footer">
              <button
                id="addTaskBtn"
                type="button"
                class="btn btn-danger btn-circle"
              >
                <i class="bi bi-arrow-up"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- boostrap  -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <!-- TODO:change this to js file -->
    <script>
      //handle local storage
      if (localStorage["tasks"] != undefined) {
        tasks = JSON.parse(localStorage["tasks"]);
      } else {
        tasks = [];
      }

      document.addEventListener("DOMContentLoaded", init);

      function init() {
        let addTaskBtn = document.getElementById("addTaskBtn");
        let date = document.getElementById("chooseDate");
        let taskName = document.getElementById("taskName");
        let priority = document.getElementById("prioritySelect");
        let time = document.getElementById("chooseTime");
        let dynamicUl = document.getElementById("dynamicUl");
        let taskModal = document.getElementById("taskModal");

        //handle alerts
        let taskNameP = document.getElementById("taskNameP");
        let dateP = document.getElementById("dateP");
        let priorityP = document.getElementById("priorityP");
        let alertPArr = document.getElementsByClassName("alertP");

        const validationFunc = () => {
          //get the date value without consider the time
          let todayDate = Date.parse(new Date().toDateString());
          let taskDate = Date.parse(new Date(date.value).toDateString());
          let success = "true";

          if (taskDate < todayDate || isNaN(taskDate)) {
            dateP.textContent = "choose valid date";
            success = false;
          }
          if (taskName.value == "") {
            taskNameP.textContent = "choose valid name";
            success = false;
          }
          if (priority.value == "") {
            priorityP.textContent = "choose priority";
            success = false;
          }
          return success;
        };
        // TODO:add renderTask function
        const addTaskFunc = () => {
          if (validationFunc()) {
            let task = {
              taskId: Date.now().toString(),
              taskName: taskName.value,
              priority: priority.value,
              date: date.value,
              time: time.value,
            };

            tasks.push(task);

            localStorage["tasks"] = JSON.stringify(tasks);

            let str = "";
            str += `<li class="list-group-item">
                <h5 class="card-title">${taskName.value}
                <input
                class="form-check-input checkBox"
                type="checkbox"
                value=""
                aria-label="..."
              /></h5>`;
            if (priority.value == "1") {
              str += `<h6 class="priority bg-danger bg-gradient text-white ">
                         high
                      </h6>`;
            }
            if (priority.value == "2") {
              str += `<h6 class="priority bg-warning bg-gradient text-white ">
                         medium
                      </h6>`;
            }
            if (priority.value == "3") {
              str += `<h6 class="priority bg-success bg-gradient text-white ">
                         low
                      </h6>`;
            }
            str += `<h6 class="card-subtitle mb-2 text-body-secondary">
                  <i class="bi bi-calendar"></i> ${date.value}, ${time.value}
                </h6>
              </li>`;

            dynamicUl.innerHTML += str;
          }
        };

        addTaskBtn.addEventListener("click", addTaskFunc);

        //clear alerts
        const cleanPAlertsFunc = (p) => {
          if (p.textContent !== "") p.textContent = "";
        };

        taskName.addEventListener("blur", () => {
          cleanPAlertsFunc(taskNameP);
        });
        date.addEventListener("blur", () => {
          cleanPAlertsFunc(dateP);
        });
        priority.addEventListener("blur", () => {
          cleanPAlertsFunc(priorityP);
        });
      }
    </script>
    <!-- my js  -->
    <!-- <script src="ToDo.js"></script> -->
  </body>
</html>
